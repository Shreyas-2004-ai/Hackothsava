# Real-Time Quiz Flow Diagram

## How Real-Time Updates Work

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SUPABASE DATABASE                            â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ quiz_rooms   â”‚  â”‚quiz_participantsâ”‚ â”‚quiz_questionsâ”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                    â”‚                 â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                           â”‚                                      â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                  â”‚ supabase_realtimeâ”‚                            â”‚
â”‚                  â”‚   publication    â”‚                            â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ WebSocket Connection
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                   â”‚                   â”‚
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TEACHER     â”‚   â”‚   STUDENT 1   â”‚   â”‚   STUDENT 2   â”‚
â”‚   Browser     â”‚   â”‚   Browser     â”‚   â”‚   Browser     â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Lobby    â”‚ â”‚   â”‚ â”‚  Lobby    â”‚ â”‚   â”‚ â”‚  Lobby    â”‚ â”‚
â”‚ â”‚  Page     â”‚ â”‚   â”‚ â”‚  Page     â”‚ â”‚   â”‚ â”‚  Page     â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚               â”‚   â”‚               â”‚   â”‚               â”‚
â”‚ ğŸŸ¢ Connected  â”‚   â”‚ ğŸŸ¢ Connected  â”‚   â”‚ ğŸŸ¢ Connected  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Event Flow Example: Student Joins

```
1. Student 2 Joins Quiz
   â”‚
   â”œâ”€â–º INSERT into quiz_participants
   â”‚   (student_name: "Bob", room_id: "abc123")
   â”‚
   â–¼
2. Supabase Realtime Detects Change
   â”‚
   â”œâ”€â–º Publishes event to supabase_realtime
   â”‚
   â–¼
3. WebSocket Broadcasts to All Subscribers
   â”‚
   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚             â”‚             â”‚
   â–¼             â–¼             â–¼
Teacher      Student 1     Student 2
Receives     Receives      Receives
Event        Event         Event
   â”‚             â”‚             â”‚
   â–¼             â–¼             â–¼
Updates      Updates       Updates
UI           UI            UI
(Shows Bob)  (Shows Bob)   (Shows self)
```

## Subscription Setup

```typescript
// Both Teacher and Student Lobby Pages

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Page Loads                               â”‚
â”‚    â”œâ”€â–º Fetch initial room data              â”‚
â”‚    â””â”€â–º Fetch initial participants           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Subscribe to Real-Time Channel           â”‚
â”‚    â”œâ”€â–º Listen to quiz_participants changes  â”‚
â”‚    â””â”€â–º Listen to quiz_rooms changes         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. On Event Received                        â”‚
â”‚    â”œâ”€â–º Log to console                       â”‚
â”‚    â”œâ”€â–º Fetch updated data                   â”‚
â”‚    â””â”€â–º Update UI                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. On Page Unload                           â”‚
â”‚    â””â”€â–º Unsubscribe from channel             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Status Indicator States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  ğŸŸ¡ CONNECTING                                       â”‚
â”‚     â”œâ”€â–º Initial state when page loads               â”‚
â”‚     â””â”€â–º Attempting to establish WebSocket           â”‚
â”‚                                                      â”‚
â”‚  ğŸŸ¢ SUBSCRIBED                                       â”‚
â”‚     â”œâ”€â–º Successfully connected                       â”‚
â”‚     â”œâ”€â–º Receiving real-time updates                 â”‚
â”‚     â””â”€â–º Auto-hides after 5 seconds                  â”‚
â”‚                                                      â”‚
â”‚  ğŸ”´ CHANNEL_ERROR / TIMED_OUT                        â”‚
â”‚     â”œâ”€â–º Connection failed                            â”‚
â”‚     â”œâ”€â–º Check Supabase status                        â”‚
â”‚     â””â”€â–º Run realtime-fix.sql                         â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow: Teacher Starts Quiz

```
Teacher Clicks "Start Quiz"
        â”‚
        â–¼
UPDATE quiz_rooms
SET status = 'active'
WHERE id = roomId
        â”‚
        â–¼
Realtime Event Published
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
    Teacher      Student 1     Student 2
        â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼
  Navigate to   Navigate to   Navigate to
  /control      /play         /play
```

## Console Log Flow

```
Page Load:
â”œâ”€â–º "ğŸ” Testing Supabase connection..."
â”œâ”€â–º "âœ… Database query successful"
â”œâ”€â–º "ğŸ”Œ Setting up realtime subscription..."
â””â”€â–º "ğŸ“Š Subscription status: SUBSCRIBED"

Student Joins:
â”œâ”€â–º "ğŸ“¡ Realtime event received: INSERT"
â”œâ”€â–º "Participant change: { eventType: 'INSERT', ... }"
â””â”€â–º "ğŸ”„ Refreshed participants (3 total)"

Teacher Starts:
â”œâ”€â–º "ğŸ“¡ Realtime event received: UPDATE"
â”œâ”€â–º "Room update: { status: 'active' }"
â””â”€â–º "Redirecting to play page..."
```

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND                          â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ Teacher Lobby   â”‚      â”‚ Student Lobby   â”‚     â”‚
â”‚  â”‚                 â”‚      â”‚                 â”‚     â”‚
â”‚  â”‚ - View students â”‚      â”‚ - View students â”‚     â”‚
â”‚  â”‚ - Start quiz    â”‚      â”‚ - Wait for startâ”‚     â”‚
â”‚  â”‚ - Real-time sub â”‚      â”‚ - Real-time sub â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                        â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Supabase Client
                         â”‚ (WebSocket + REST)
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        â”‚                          â”‚
â”‚                   SUPABASE                        â”‚
â”‚                        â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         PostgreSQL Database               â”‚   â”‚
â”‚  â”‚                                            â”‚   â”‚
â”‚  â”‚  - quiz_rooms                              â”‚   â”‚
â”‚  â”‚  - quiz_participants                       â”‚   â”‚
â”‚  â”‚  - quiz_questions                          â”‚   â”‚
â”‚  â”‚                                            â”‚   â”‚
â”‚  â”‚  RLS Policies:                             â”‚   â”‚
â”‚  â”‚  âœ“ Teachers can manage own quizzes        â”‚   â”‚
â”‚  â”‚  âœ“ Students can view and join             â”‚   â”‚
â”‚  â”‚  âœ“ Anyone can view participants           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                        â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Realtime Publication                 â”‚   â”‚
â”‚  â”‚                                            â”‚   â”‚
â”‚  â”‚  Enabled for:                              â”‚   â”‚
â”‚  â”‚  âœ“ quiz_rooms                              â”‚   â”‚
â”‚  â”‚  âœ“ quiz_participants                       â”‚   â”‚
â”‚  â”‚  âœ“ quiz_questions                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Troubleshooting Flow

```
Real-time not working?
        â”‚
        â–¼
Check Status Indicator
        â”‚
        â”œâ”€â–º ğŸŸ¢ Connected?
        â”‚   â””â”€â–º Working! No action needed
        â”‚
        â”œâ”€â–º ğŸŸ¡ Connecting?
        â”‚   â””â”€â–º Wait 5 seconds, should turn green
        â”‚
        â””â”€â–º ğŸ”´ Error?
            â”‚
            â–¼
    Run supabase-realtime-fix.sql
            â”‚
            â–¼
    Restart dev server
            â”‚
            â–¼
    Clear browser cache
            â”‚
            â–¼
    Check browser console
            â”‚
            â”œâ”€â–º "SUBSCRIBED"? âœ… Fixed!
            â”‚
            â””â”€â–º Still errors?
                â””â”€â–º Check REALTIME_TROUBLESHOOTING.md
```

## Performance Considerations

```
Free Tier:
â”œâ”€â–º Latency: 1-2 seconds
â”œâ”€â–º Max connections: 200
â””â”€â–º Good for: Testing, small classes

Paid Tier:
â”œâ”€â–º Latency: <500ms
â”œâ”€â–º Max connections: 500+
â””â”€â–º Good for: Production, large classes

Optimization Tips:
â”œâ”€â–º Use specific filters (room_id=eq.xxx)
â”œâ”€â–º Unsubscribe when leaving page
â”œâ”€â–º Batch updates when possible
â””â”€â–º Monitor connection count
```
